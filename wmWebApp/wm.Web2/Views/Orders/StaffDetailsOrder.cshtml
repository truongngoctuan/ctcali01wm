@using wm.Web2.Models
@model IEnumerable<wm.Model.GoodCategory>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    title here
    <hr />
    <div class="row">
        @Html.Partial("_DetailsOrder_GoodCategory", new EditOrder_GoodCategoryViewModel { GoodCategories = Model, EditAction = "StaffDetailsOrder", orderId = ViewBag.OrderId })
        @Html.Partial("_EditDetailsOrder_Handsontable")

    </div>

</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        $(document).ready(function () {
            $(".GoodCategoryItem[id$='GoodCategoryItem"+ @ViewBag.GoodCategoryId + "']").addClass("active");//for decoration
        });

        function clickGoodCategoryItem(url) {
            window.location.href = url;
        }

        var $$ = function (id) {
                return document.getElementById(id);
            },
            container = $$('hsIncludeExclude'),
            autosave = $$('autosave'),
            load = $$('load'),
            save = $$('save'),
            autosaveNotification,
            hot,
            dataInput;

        var OrderId = @ViewBag.OrderId;
        var GoodCategoryId = @ViewBag.GoodCategoryId;
        $(document).ready(function () {
            loadIncludeExclude(OrderId, GoodCategoryId);
        });

        hot = new Handsontable(container, {
            startRows: 1,
            startCols: 2,
            allowInvalid: false,
            rowHeaders: true,
            colHeaders: ['Name','InStock','RecommendQuantity', 'Quantity', 'Note', 'YourNote'],
            dataSchema: { Id: null, Name: null, RecommendedQuantity: null, Quantity: null },
            columns: [//TODO: change colorbackground for readonly
                //{ Data: 'CategoryId', readOnly: true },
                { data: 'Name', readOnly: true },
                { data: 'InStock', readOnly: true },
                { data: 'RecommenedQuantity', readOnly: true },
                { data: 'Quantity', readOnly: true, type : 'numeric',format: '0,0.00', allowInvalid: true},
                { data: 'Note', readOnly: true },
                { data: 'YourNote', readOnly: true }

                //{ Data: 'IsChecked', type: 'checkbox' },
            ]
        });

        function loadIncludeExclude() {
            postHelper('@Url.Action("PopulateData")', {orderId : OrderId, goodCategoryId: GoodCategoryId},
                function (data) {
                    console.log("client received: " + data);

                    dataInput = JSON.parse(data);
                    hot.loadData(dataInput);

                });
        }
    </script>
}
