@using wm.Web2.Models
@model IEnumerable<wm.Model.GoodCategory>
@{
    ViewBag.Title = "ManagerEditOrder";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Warehouse keeper EditOrder for Main kitchen</h2>


<div class="row">
    <h4>Update good categories</h4>
    <hr />
    <div class="row">
        @Html.Partial("_EditOrder_GoodCategory", new EditOrder_GoodCategoryViewModel { GoodCategories = Model, EditAction = "WhKeeperEditOrder", orderId = ViewBag.OrderId })

        @Html.Partial("_EditOrder_Handsontable")

    </div>

</div>

@*<div>
        @Html.ActionLink("Back to List", "Index")
    </div>*@<div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Content/EditOrderHelper.js"></script>
    <script>
        $(document).ready(function() {
            $(".GoodCategoryItem[id$='GoodCategoryItem" + @ViewBag.GoodCategoryId + "']").addClass("active"); //for decoration

            window.isDataChanged = false;
        });
    </script>

    <script>
        var $$ = function(id) {
            return document.getElementById(id);
        },
            container = $$('hsIncludeExclude'),
            hot;

        window.OrderId = @ViewBag.OrderId;
        window.GoodCategoryId = @ViewBag.GoodCategoryId;
        $(document).ready(function() {
            hot = new Handsontable(container, {
                startRows: 1,
                startCols: 2,
                allowInvalid: false,
                rowHeaders: true,
                colHeaders: ['Name','', '', '', '', '', '','', '', '','', 'Sum', 'InStock','recommend', 'Quantity', 'Note', 'YourNote'],
                //dataSchema: { Id: null, Name: null, QuantityFromBranch: null, InStock: null, RecommendedQuantity: null, Quantity: null, Note: null, YourNote: null},
                columns: [//TODO: change colorbackground for readonly
                    //{ Data: 'CategoryId', readOnly: true },
                    { data: 'Name', readOnly: true },
                    { data: 'Details.1', readOnly: true },
                    { data: 'Details.2', readOnly: true },
                    { data: 'Details.3', readOnly: true },
                    { data: 'Details.4', readOnly: true },
                    { data: 'Details.5', readOnly: true },
                    { data: 'Details.6', readOnly: true },
                    { data: 'Details.7', readOnly: true },
                    { data: 'Details.8', readOnly: true },
                    { data: 'Details.9', readOnly: true },
                    { data: 'Details.10', readOnly: true },
                    { data: 'QuantityFromBranch', readOnly: true },
                    { data: 'InStock', readOnly: false },
                    { data: 'RecommenedQuantity', readOnly: true },
                    { data: 'Quantity', readOnly: false, type : 'numeric',format: '0,0.00', allowInvalid: true},
                    { data: 'Note', readOnly: true },
                    { data: 'YourNote', readOnly: false }

                    //{ Data: 'IsChecked', type: 'checkbox' },
                ],
                afterChange: function (change, source) {
                    if (source === 'loadData') {
                        return; //don't save this change
                    }
                    console.log("change: " + JSON.stringify(hot.getSourceDataAtRow(change[0][0])));
                    window.isDataChanged = true;
                }
            });

            loadIncludeExclude('@Url.Action("PopulateData")');
        });


    </script>

}
